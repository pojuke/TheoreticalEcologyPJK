<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Week 5 - Metapopulations and patch occupancy models | Introduction to Theoretical Ecology</title>
  <meta name="description" content="This is the course website for Introduction to Theoretical Ecology 2024 Fall at National Taiwan University." />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Week 5 - Metapopulations and patch occupancy models | Introduction to Theoretical Ecology" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://pojuke.github.io/TheoreticalEcologyPJK/bifurcation.gif" />
  <meta property="og:description" content="This is the course website for Introduction to Theoretical Ecology 2024 Fall at National Taiwan University." />
  <meta name="github-repo" content="pojuke/TheoreticalEcologyPJK" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Week 5 - Metapopulations and patch occupancy models | Introduction to Theoretical Ecology" />
  
  <meta name="twitter:description" content="This is the course website for Introduction to Theoretical Ecology 2024 Fall at National Taiwan University." />
  <meta name="twitter:image" content="https://pojuke.github.io/TheoreticalEcologyPJK/bifurcation.gif" />

<meta name="author" content="Instructor: Po-Ju Ke ~~~~~ Teaching Assistant: Hsiang-Chih Lo" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="week-4---logistic-population-growth-and-stability-analysis.html"/>
<link rel="next" href="week-6---harvesting-and-bifurcation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to Theoretical Ecology</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Course information</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html"><i class="fa fa-check"></i>Syllabus</a></li>
<li class="chapter" data-level="" data-path="week-2---exponential-population-growth.html"><a href="week-2---exponential-population-growth.html"><i class="fa fa-check"></i>Week 2 - Exponential population growth</a></li>
<li class="chapter" data-level="" data-path="week-4---logistic-population-growth-and-stability-analysis.html"><a href="week-4---logistic-population-growth-and-stability-analysis.html"><i class="fa fa-check"></i>Week 4 - Logistic population growth and stability analysis</a></li>
<li class="chapter" data-level="" data-path="week-5---metapopulations-and-patch-occupancy-models.html"><a href="week-5---metapopulations-and-patch-occupancy-models.html"><i class="fa fa-check"></i>Week 5 - Metapopulations and patch occupancy models</a></li>
<li class="chapter" data-level="" data-path="week-6---harvesting-and-bifurcation.html"><a href="week-6---harvesting-and-bifurcation.html"><i class="fa fa-check"></i>Week 6 - Harvesting and bifurcation</a></li>
<li class="chapter" data-level="" data-path="week-7---age-structure-population-model.html"><a href="week-7---age-structure-population-model.html"><i class="fa fa-check"></i>Week 7 - Age-structure population model</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Theoretical Ecology</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="week-5---metapopulations-and-patch-occupancy-models" class="section level1 unnumbered hasAnchor">
<h1>Week 5 - Metapopulations and patch occupancy models<a href="week-5---metapopulations-and-patch-occupancy-models.html#week-5---metapopulations-and-patch-occupancy-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>    Plants can condition nearby soil microbial communities, which will in turn influence the performance of subsequent colonizing plants. The soil beneath plant communities are therefore a mosaic with different cultivation histories. Po-Ju wants to understand how plant demographic rates (i.e., colonization and mortality rate) and microbial dynamics (i.e., the conditioning and decay rate of microbial communities) affect the percentage of different soil types in natural forests. As a starting point, Po-Ju builds a one-species patch occupancy model to track the dynamics of different types of plant-soil combination.</p>
<p>    In this model, he characterizes sites by their plant-soil microbe state, using the notation <span class="math inline">\(P_{ij}\)</span> to indicate sites that are now occupied by plant species <span class="math inline">\(i\)</span> but have soil microbes state <span class="math inline">\(j\)</span>. Here, as a single species model, <span class="math inline">\(i\)</span> can be 0 or <span class="math inline">\(A\)</span>, representing uncolonized sites or sites colonized by plant <span class="math inline">\(A\)</span>, respectively. Similarly, <span class="math inline">\(j\)</span> can be 0 or <span class="math inline">\(A\)</span>, indicating sites without recent plant conditioning history or sites conditioned by plant <span class="math inline">\(A\)</span>, respectively. In summary:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(P_{00}\)</span> represents uncolonized and unconditioned sites</li>
<li><span class="math inline">\(P_{A0}\)</span> represents cites colonized by plant <span class="math inline">\(A\)</span> but the soil is yet to be conditioned</li>
<li><span class="math inline">\(P_{AA}\)</span> represents plant <span class="math inline">\(A\)</span> colonizing a site with plant-<span class="math inline">\(A\)</span>-specific microbial community</li>
<li><span class="math inline">\(P_{0A}\)</span> represents sites that are currently unoccupied but have soil microbes that were associated with plant <span class="math inline">\(A\)</span></li>
</ol>
<p>At the landscape scale, <span class="math inline">\(P_{ij}\)</span> represents the proportion of sites belonging to a particular plant-soil microbe state, and its dynamics, <span class="math inline">\(\frac {dP_{ij}}{dt}\)</span>, summarizes the processes of plant colonization and death. The transitions between different plant-soil microbe states can be described by the following figure.</p>
<p><img src="Plant_soil_model.png" width="100%"/></p>
<p>Here, <span class="math inline">\(P_{00}\)</span> can be colonized by plant <span class="math inline">\(A\)</span> when propagules arrive (per capita rate <span class="math inline">\(r_{A}\)</span>), transitioning the state from <span class="math inline">\(P_{00}\)</span> to <span class="math inline">\(P_{A0}\)</span>. Plants may die, with rate <span class="math inline">\(m_{A}\)</span>, before conditioning the soil (i.e., transition from <span class="math inline">\(P_{A0}\)</span> back to <span class="math inline">\(P_{00}\)</span>), or may successfully condition the soil with rate <span class="math inline">\(c_{A}\)</span> (i.e., transition from <span class="math inline">\(P_{A0}\)</span> to <span class="math inline">\(P_{AA}\)</span>). After plants within the state <span class="math inline">\(P_{AA}\)</span> die, a site with microbial legacy is left behind, denoted as <span class="math inline">\(P_{0A}\)</span>. These empty sites can be recolonized (i.e., transition from <span class="math inline">\(P_{0A}\)</span> back to <span class="math inline">\(P_{AA}\)</span>) with rates affected by the microbial legacy effect, <span class="math inline">\(\alpha\)</span>. Finally, the microbial community within the soil may decay to unconditioned state with rate <span class="math inline">\(d_{A}\)</span>, transitioning the state from <span class="math inline">\(P_{0A}\)</span> to <span class="math inline">\(P_{00}\)</span>.</p>
<p>    In this lab, we are going to model the dynamics of this plant-soil system. We will start by converting the flow diagram into a set of differential equations and then solve them numerically using the package <code>deSolve</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-1" tabindex="-1"></a><span class="fu">library</span>(deSolve)</span>
<span id="cb22-2"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb22-3"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-3" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb22-4"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-4" tabindex="-1"></a></span>
<span id="cb22-5"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-5" tabindex="-1"></a></span>
<span id="cb22-6"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-6" tabindex="-1"></a><span class="do">### Model specification</span></span>
<span id="cb22-7"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-7" tabindex="-1"></a>PSF <span class="ot">=</span> <span class="cf">function</span>(Time, State, Pars){</span>
<span id="cb22-8"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-8" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(State, Pars)),{</span>
<span id="cb22-9"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-9" tabindex="-1"></a>    dP00_dt <span class="ot">=</span> <span class="sc">-</span> rA <span class="sc">*</span> (PA0 <span class="sc">+</span> PAA) <span class="sc">*</span> P00 <span class="sc">+</span> mA <span class="sc">*</span> PA0 <span class="sc">+</span> dA <span class="sc">*</span> P0A </span>
<span id="cb22-10"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-10" tabindex="-1"></a>    dPA0_dt <span class="ot">=</span> rA <span class="sc">*</span> (PA0 <span class="sc">+</span> PAA) <span class="sc">*</span> P00 <span class="sc">-</span> cA <span class="sc">*</span> PA0 <span class="sc">-</span> mA <span class="sc">*</span> PA0</span>
<span id="cb22-11"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-11" tabindex="-1"></a>    dPAA_dt <span class="ot">=</span> cA <span class="sc">*</span> PA0 <span class="sc">+</span> alpha <span class="sc">*</span> rA <span class="sc">*</span> (PA0 <span class="sc">+</span> PAA) <span class="sc">*</span> P0A <span class="sc">-</span> mA <span class="sc">*</span> PAA</span>
<span id="cb22-12"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-12" tabindex="-1"></a>    dP0A_dt <span class="ot">=</span> mA <span class="sc">*</span> PAA <span class="sc">-</span> alpha <span class="sc">*</span> rA <span class="sc">*</span> (PA0 <span class="sc">+</span> PAA) <span class="sc">*</span> P0A <span class="sc">-</span> dA <span class="sc">*</span> P0A</span>
<span id="cb22-13"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-13" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">c</span>(dP00_dt, dPA0_dt, dPAA_dt, dP0A_dt)))</span>
<span id="cb22-14"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-14" tabindex="-1"></a>  })</span>
<span id="cb22-15"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-15" tabindex="-1"></a>}</span>
<span id="cb22-16"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-16" tabindex="-1"></a></span>
<span id="cb22-17"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-17" tabindex="-1"></a></span>
<span id="cb22-18"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-18" tabindex="-1"></a><span class="do">#### Set simulation parameters with the &#39;quick simulation parameters&#39;</span></span>
<span id="cb22-19"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-19" tabindex="-1"></a>pars <span class="ot">=</span> <span class="fu">c</span>(<span class="at">rA =</span> <span class="fl">0.5</span>,</span>
<span id="cb22-20"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-20" tabindex="-1"></a>         <span class="at">mA =</span> <span class="fl">0.1</span>,</span>
<span id="cb22-21"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-21" tabindex="-1"></a>         <span class="at">cA =</span> <span class="fl">0.5</span>,</span>
<span id="cb22-22"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-22" tabindex="-1"></a>         <span class="at">dA =</span> <span class="fl">0.4</span>,</span>
<span id="cb22-23"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-23" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fl">0.3</span>)</span>
<span id="cb22-24"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-24" tabindex="-1"></a></span>
<span id="cb22-25"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-25" tabindex="-1"></a></span>
<span id="cb22-26"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-26" tabindex="-1"></a><span class="do">#### Set initial condition and time steps</span></span>
<span id="cb22-27"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-27" tabindex="-1"></a>times <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb22-28"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-28" tabindex="-1"></a>ini <span class="ot">=</span> <span class="fu">c</span>(<span class="at">P00 =</span> <span class="fl">0.75</span>, <span class="at">PA0 =</span> <span class="fl">0.1</span>, <span class="at">PAA =</span> <span class="fl">0.05</span>, <span class="at">P0A =</span> <span class="fl">0.1</span>)</span>
<span id="cb22-29"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-29" tabindex="-1"></a></span>
<span id="cb22-30"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-30" tabindex="-1"></a></span>
<span id="cb22-31"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-31" tabindex="-1"></a><span class="do">#### Run the simulation</span></span>
<span id="cb22-32"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-32" tabindex="-1"></a>pop_size <span class="ot">=</span> <span class="fu">ode</span>(<span class="at">func =</span> PSF, <span class="at">y =</span> ini, <span class="at">parms =</span> pars, <span class="at">times =</span> times)</span>
<span id="cb22-33"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-33" tabindex="-1"></a></span>
<span id="cb22-34"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-34" tabindex="-1"></a></span>
<span id="cb22-35"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-35" tabindex="-1"></a><span class="do">#### Check if simulations reached stable point </span></span>
<span id="cb22-36"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb22-36" tabindex="-1"></a><span class="fu">tail</span>(pop_size)</span></code></pre></div>
<pre><code>##          time       P00        PA0       PAA       P0A
##  [996,]  99.5 0.1634825 0.09738004 0.6174124 0.1217251
##  [997,]  99.6 0.1634825 0.09738004 0.6174124 0.1217251
##  [998,]  99.7 0.1634825 0.09738004 0.6174124 0.1217251
##  [999,]  99.8 0.1634825 0.09738004 0.6174124 0.1217251
## [1000,]  99.9 0.1634825 0.09738004 0.6174124 0.1217251
## [1001,] 100.0 0.1634825 0.09738004 0.6174124 0.1217251</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb24-1" tabindex="-1"></a><span class="fu">rowSums</span>(<span class="fu">tail</span>(pop_size[, <span class="sc">-</span><span class="dv">1</span>]))</span></code></pre></div>
<pre><code>##  [996,]  [997,]  [998,]  [999,] [1000,] [1001,] 
##       1       1       1       1       1       1</code></pre>
<p>    After checking the outcomes of our numerical simulation, we can visualize the system dynamics through time, using any method you prefer. The following are some examples:</p>
<p>Visualization of the system dynamics through time using function <code>matplot</code>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb26-1" tabindex="-1"></a><span class="do">#### Plot (matplot)</span></span>
<span id="cb26-2"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb26-2" tabindex="-1"></a><span class="fu">matplot</span>(<span class="at">x =</span> pop_size[, <span class="dv">1</span>], <span class="at">y =</span> pop_size[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Visualization of the system dynamics through time using base R, with axis labels and given line colors.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb27-1" tabindex="-1"></a><span class="do">#### Plot (base R)</span></span>
<span id="cb27-2"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb27-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">range</span>(times), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Time&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Proportion&quot;</span>)</span>
<span id="cb27-3"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb27-3" tabindex="-1"></a><span class="fu">lines</span>(P00 <span class="sc">~</span> time, <span class="at">data =</span> pop_size, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb27-4"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb27-4" tabindex="-1"></a><span class="fu">lines</span>(PA0 <span class="sc">~</span> time, <span class="at">data =</span> pop_size, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb27-5"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb27-5" tabindex="-1"></a><span class="fu">lines</span>(PAA <span class="sc">~</span> time, <span class="at">data =</span> pop_size, <span class="at">col =</span> <span class="st">&quot;purple&quot;</span>)</span>
<span id="cb27-6"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb27-6" tabindex="-1"></a><span class="fu">lines</span>(P0A <span class="sc">~</span> time, <span class="at">data =</span> pop_size, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb27-7"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb27-7" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, </span>
<span id="cb27-8"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb27-8" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;P00&quot;</span>, <span class="st">&quot;PA0&quot;</span>, <span class="st">&quot;PAA&quot;</span>, <span class="st">&quot;P0A&quot;</span>), </span>
<span id="cb27-9"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb27-9" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;purple&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Data organization using package <code>tidyverse</code> and visualization of the system dynamics through time using package <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb28-1" tabindex="-1"></a><span class="do">### ggplot course website version</span></span>
<span id="cb28-2"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb28-2" tabindex="-1"></a>pop_size <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb28-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb28-4" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">&quot;Patch&quot;</span>, <span class="at">value =</span> <span class="st">&quot;Proportion&quot;</span>, <span class="sc">-</span>time) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb28-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> Proportion, <span class="at">color =</span> Patch)) <span class="sc">+</span></span>
<span id="cb28-6"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb28-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>    Now we see that the system would eventually be stable, we can jump through the time series and directly take the final equilibrium point (assuming the selected simulation length works for different parameter values). Our next step is to modify the target parameter related to our research question and study their resulting outcome. For example, we want to see how the final fate of this system would change under different decay rates of the conditioned microbial effect (i.e., d_{A}, the transitioning from P_{0A} to uncolonized and unconditioned soil P_{00}). We can efficiently vary the target parameter using a for-loop to run the simulation under different decay rates.</p>
<p>Using for loop to run the simulation under different decay rates (<span class="math inline">\(d_{A}\)</span>).</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-1" tabindex="-1"></a><span class="do">### For-loop over different parameter values </span></span>
<span id="cb29-2"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-2" tabindex="-1"></a><span class="do">### Parameter range and saving space setup</span></span>
<span id="cb29-3"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-3" tabindex="-1"></a>dA_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.1</span>, <span class="at">to =</span> <span class="fl">0.8</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb29-4"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-4" tabindex="-1"></a>Data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(dA_seq), <span class="at">ncol =</span> <span class="dv">6</span>))</span>
<span id="cb29-5"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-5" tabindex="-1"></a><span class="fu">names</span>(Data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;dA&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;P00&quot;</span>, <span class="st">&quot;PA0&quot;</span>, <span class="st">&quot;PAA&quot;</span>, <span class="st">&quot;P0A&quot;</span>)</span>
<span id="cb29-6"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-6" tabindex="-1"></a>Data[, <span class="dv">1</span>] <span class="ot">&lt;-</span> dA_seq</span>
<span id="cb29-7"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-7" tabindex="-1"></a></span>
<span id="cb29-8"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-8" tabindex="-1"></a><span class="do">### Use for loop to change the parameter every time</span></span>
<span id="cb29-9"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-9" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(dA_seq)){</span>
<span id="cb29-10"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-10" tabindex="-1"></a>  </span>
<span id="cb29-11"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-11" tabindex="-1"></a>  <span class="co"># Set simulation parameters</span></span>
<span id="cb29-12"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-12" tabindex="-1"></a>  pars_new <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">rA =</span> <span class="fl">0.5</span>, <span class="at">mA =</span> <span class="fl">0.1</span>, <span class="at">cA =</span> <span class="fl">0.5</span>, <span class="at">dA =</span> dA_seq[i], <span class="at">alpha =</span> <span class="fl">0.3</span>)</span>
<span id="cb29-13"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-13" tabindex="-1"></a>  </span>
<span id="cb29-14"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-14" tabindex="-1"></a>  <span class="co"># Simulate</span></span>
<span id="cb29-15"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-15" tabindex="-1"></a>  pop_size_new <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">func =</span> PSF, <span class="at">y =</span> ini, <span class="at">parms =</span> pars_new, <span class="at">times =</span> times)</span>
<span id="cb29-16"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-16" tabindex="-1"></a>  </span>
<span id="cb29-17"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-17" tabindex="-1"></a>  <span class="co"># Save results</span></span>
<span id="cb29-18"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-18" tabindex="-1"></a>  Data[i, <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)] <span class="ot">&lt;-</span> pop_size_new[<span class="fu">length</span>(times), ]</span>
<span id="cb29-19"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb29-19" tabindex="-1"></a>}</span></code></pre></div>
<p>Visualization of the stable state under different decay rates (<span class="math inline">\(d_{A}\)</span>) using base R, with axis labels and given line colors. Does the pattern match your intuition?</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb30-1" tabindex="-1"></a><span class="do">### Plot resulting equilibrium against different dA  </span></span>
<span id="cb30-2"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb30-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">range</span>(dA_seq), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb30-3"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb30-3" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Decay rate of conditioned soil&quot;</span>, </span>
<span id="cb30-4"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb30-4" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Equilibrium proportion&quot;</span>)</span>
<span id="cb30-5"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb30-5" tabindex="-1"></a><span class="fu">lines</span>(P00 <span class="sc">~</span> dA, <span class="at">data =</span> Data, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb30-6"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb30-6" tabindex="-1"></a><span class="fu">lines</span>(PA0 <span class="sc">~</span> dA, <span class="at">data =</span> Data, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb30-7"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb30-7" tabindex="-1"></a><span class="fu">lines</span>(PAA <span class="sc">~</span> dA, <span class="at">data =</span> Data, <span class="at">col =</span> <span class="st">&quot;purple&quot;</span>)</span>
<span id="cb30-8"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb30-8" tabindex="-1"></a><span class="fu">lines</span>(P0A <span class="sc">~</span> dA, <span class="at">data =</span> Data, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb30-9"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb30-9" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, </span>
<span id="cb30-10"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb30-10" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;P00&quot;</span>, <span class="st">&quot;PA0&quot;</span>, <span class="st">&quot;PAA&quot;</span>, <span class="st">&quot;P0A&quot;</span>), </span>
<span id="cb30-11"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb30-11" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;purple&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-22-1.png" width="672" />
Visualization of the stable state under different decay rates (<span class="math inline">\(d_{A}\)</span>) using package <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb31-1" tabindex="-1"></a><span class="do">### ggplot course website version</span></span>
<span id="cb31-2"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb31-2" tabindex="-1"></a>Data <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb31-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb31-4" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">&quot;Patch&quot;</span>, <span class="at">value =</span> <span class="st">&quot;Proportion&quot;</span>,<span class="sc">-</span>dA, <span class="sc">-</span>time) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb31-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dA, <span class="at">y =</span> Proportion, <span class="at">color =</span> Patch)) <span class="sc">+</span></span>
<span id="cb31-6"><a href="week-5---metapopulations-and-patch-occupancy-models.html#cb31-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="week-4---logistic-population-growth-and-stability-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="week-6---harvesting-and-bifurcation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ChingLinHuang/2022_Fall_TheoEcol/04_Week_4_afterclass.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
